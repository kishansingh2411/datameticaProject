--######################################################################################################################
--#   This source code is the property of:
--#   Cablevision Systems Corporation, Inc. (c) 2015
--#   1111 Stewart Avenue, Bethpage, NY 11714
--#   www.cablevision.com
--#   Department: AM
--#
--#   Program name: module-transform.hql
--#   Program type: Hive Query Language script
--#   Purpose:    : Build gold_rsdvr_requests_archive_last_rec_tbl table 
--#   Author(s)   : DataMetica Team
--#   Usage       : beeline -u  <url> -n <username> -p <password> -hivevar var1=var1 -f module-transform.hql
--#   Date        : 12/28/2015
--#   Log File    : .../log/mrdvr/${job_name}.log
--#   SQL File    : 
--#   Error File  : .../log/mrdvr/${job_name}.log
--#   Dependency  : 
--#   Disclaimer  : 
--#
--#   Modification History :
--#   =======================
--#
--#    ver     who                      date             comments
--#   ------   --------------------     ----------       -------------------------------------
--#    1.0     DataMetica Team          12/28/2015       Initial version
--#
--#
--#####################################################################################################################

set hive.exec.dynamic.partition=true;
set hive.exec.dynamic.partition.mode=nonstrict;

INSERT OVERWRITE TABLE ${hivevar:hive_database_name_gold}.${hivevar:gold_rsdvr_requests_archive_last_rec_tbl} 
SELECT 
	case when GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SCHEDULE_ID is null then WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SCHEDULE_ID end as SCHEDULE_ID,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.HOME_ID else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.HOME_ID_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.HOME_ID end as HOME_ID,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SERIAL_NUMBER else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SERIAL_NUMBER_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SERIAL_NUMBER end as SERIAL_NUMBER,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MAC_ADDRESS else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.MAC_ADDRESS_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MAC_ADDRESS end as MAC_ADDRESS,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.CALL_SIGN else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CALL_SIGN_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.CALL_SIGN end as CALL_SIGN,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_DATE else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.START_DATE_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_DATE end as START_DATE,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_TIME else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.START_TIME_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_TIME end as START_TIME,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DURATION else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.DURATION_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DURATION end as DURATION,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.RECORDING_TYPE else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.RECORDING_TYPE_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.RECORDING_TYPE end as RECORDING_TYPE,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_ALL else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SAVE_ALL_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_ALL end as SAVE_ALL,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_LATEST else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SAVE_LATEST_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_LATEST end as SAVE_LATEST,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.CREATE_TIME else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CREATE_TIME_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.CREATE_TIME end as CREATE_TIME,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MODIFIED_TIME else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.MODIFIED_TIME_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MODIFIED_TIME end as MODIFIED_TIME,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.END_TIME_ADJUSTMENT else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.END_TIME_ADJUSTMENT_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.END_TIME_ADJUSTMENT end as END_TIME_ADJUSTMENT,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_DAYS else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SAVE_DAYS_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_DAYS end as SAVE_DAYS,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.STATUS else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.STATUS_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.STATUS end as STATUS,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SHORT_TITLE else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SHORT_TITLE_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SHORT_TITLE end as SHORT_TITLE,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.ARCHIVE_DATE_EST else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.ARCHIVE_DATE_EST_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.ARCHIVE_DATE_EST end as ARCHIVE_DATE_EST,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SOURCE_LOAD_DATE else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SOURCE_LOAD_DATE_INCOMING end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SOURCE_LOAD_DATE end as SOURCE_LOAD_DATE,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MAC_ADDRESS_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.MAC_ADDRESS_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MAC_ADDRESS_IND end          AS MAC_ADDRESS_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.CALL_SIGN_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CALL_SIGN_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.CALL_SIGN_IND end            AS CALL_SIGN_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_DATE_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.START_DATE_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_DATE_IND end          AS START_DATE_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_TIME_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.START_TIME_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.START_TIME_IND end      AS START_TIME_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DURATION_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.DURATION_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DURATION_IND end           AS DURATION_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.RECORDING_TYPE_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.RECORDING_TYPE_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.RECORDING_TYPE_IND end      AS RECORDING_TYPE_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_ALL_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SAVE_ALL_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_ALL_IND end         AS SAVE_ALL_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_LATEST_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SAVE_LATEST_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_LATEST_IND end         AS SAVE_LATEST_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MODIFIED_TIME_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.MODIFIED_TIME_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.MODIFIED_TIME_IND end       AS MODIFIED_TIME_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.END_TIME_ADJUSTMENT_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.END_TIME_ADJUSTMENT_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.END_TIME_ADJUSTMENT_IND end AS END_TIME_ADJUSTMENT_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_DAYS_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SAVE_DAYS_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SAVE_DAYS_IND end AS SAVE_DAYS_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.STATUS_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.STATUS_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.STATUS_IND end  AS STATUS_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SHORT_TITLE_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SHORT_TITLE_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SHORT_TITLE_IND end  AS SHORT_TITLE_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.ARCHIVE_DATE_EST_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.ARCHIVE_DATE_EST_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.ARCHIVE_DATE_EST_IND end AS ARCHIVE_DATE_EST_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SOURCE_LOAD_DATE_IND else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SOURCE_LOAD_DATE_IND end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SOURCE_LOAD_DATE_IND end AS SOURCE_LOAD_DATE_IND,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG='FALSE' and WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG='FALSE' then WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.OP_TYPE_U else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.OP_TYPE_I end ) else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.OP_TYPE_U end as OP_TYPE,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DTM_CREATED else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.DTM_SYSDATE end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DTM_CREATED end  as DTM_CREATED,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.RSDVR_REQUESTS_DELTA_SEQ else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.RSDVR_REQUESTS_DELTA_SEQ end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.RSDVR_REQUESTS_DELTA_SEQ end AS RSDVR_REQUESTS_DELTA_SEQ,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DTM_LAST_MODIFIED else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.DTM_SYSDATE end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DTM_LAST_MODIFIED end as DTM_LAST_MODIFIED,
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DTM_LAST_UPDATED else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.DTM_SYSDATE end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.DTM_LAST_UPDATED end  as DTM_LAST_UPDATED
	case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING is not null then ( case when WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.CHANGEDFLAG IS NULL AND WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.NEWFLAG IS NULL then GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.LOAD_DATE else WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.LOAD_DATE end ) else GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.LOAD_DATE end as LOAD_DATE	
FROM 
	${hivevar:hive_database_name_gold}.${hivevar:gold_rsdvr_requests_archive_last_rec_tbl} GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC FULL OUTER JOIN ${hivevar:hive_database_name_work}.${hivevar:work_rsdvr_requests_archive_dedup_tbl} WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP 
ON
	(GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SCHEDULE_ID = WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SCHEDULE_ID_INCOMING AND
	 GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.HOME_ID = WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.HOME_ID_INCOMING AND
	 GOLD_RSDVR_REQUESTS_ARCHIVE_LAST_REC.SERIAL_NUMBER = WORK_RSDVR_REQUESTS_ARCHIVE_DEDUP.SERIAL_NUMBER_INCOMING
	)
;

--##############################################################################
--#                                    End                                     #
--##############################################################################