--######################################################################################################################
--#   this source code is the property of:
--#   cablevision systems corporation, inc. (c) 2015
--#   1111 stewart avenue, bethpage, ny 11714
--#   www.cablevision.com
--#   department: am
--#
--#   program name: module-transform.hql
--#   program type: hive query language script
--#   purpose:    : build work_rsdvr_schedule_tmp_tbl table 
--#   author(s)   : DataMetica Team
--#   usage       : beeline -u  <url> -n <username> -p <password> -hivevar var1=var1 -f module-transform.hql
--#   date        : 09/12/2016
--#   log file    : .../log/mrdvr/${job_name}.log
--#   sql file    : 
--#   error file  : .../log/mrdvr/${job_name}.log
--#   dependency  : 
--#   disclaimer  : 
--#
--#   modification history :
--#   =======================
--#
--#    ver     who                      date             comments
--#   ------   --------------------     ----------       -------------------------------------
--#    1.0     DataMetica Team          12/28/2015       initial version
--#
--#
--#####################################################################################################################

set hive.exec.dynamic.partition=true;
set hive.exec.dynamic.partition.mode=nonstrict;

INSERT OVERWRITE TABLE ${hivevar:hive_database_name_work}.${hivevar:work_rsdvr_schedule_tmp_tbl} 
SELECT
	INCOMING_RSDVR_SCHEDULE.CALLSIGN AS CALLSIGN_INCOMING,
	INCOMING_RSDVR_SCHEDULE.STARTDATE AS STARTDATE_INCOMING,
	case when (length(INCOMING_RSDVR_SCHEDULE.starttime)=3) then concat(substr(concat('0',INCOMING_RSDVR_SCHEDULE.starttime),0,2),':',substr(concat('0',INCOMING_RSDVR_SCHEDULE.starttime),3,2),':00') when (length(INCOMING_RSDVR_SCHEDULE.starttime)=2) then concat(substr(concat('00',INCOMING_RSDVR_SCHEDULE.starttime),0,2),':',substr(concat('00',INCOMING_RSDVR_SCHEDULE.starttime),3,2),':00') when (length(INCOMING_RSDVR_SCHEDULE.starttime)=1) then concat(substr(concat('000',INCOMING_RSDVR_SCHEDULE.starttime),0,2),':',substr(concat('000',INCOMING_RSDVR_SCHEDULE.starttime),3,2),':00') else concat(substr(INCOMING_RSDVR_SCHEDULE.starttime,0,2),':',substr(INCOMING_RSDVR_SCHEDULE.starttime,3,2),':00') end AS STARTTIME_INCOMING,
	INCOMING_RSDVR_SCHEDULE.DURATION AS DURATION_INCOMING,
	INCOMING_RSDVR_SCHEDULE.SHORT_TITLE AS SHORT_TITLE_INCOMING,
	INCOMING_RSDVR_SCHEDULE.LONG_TITLE  AS LONG_TITLE_INCOMING,
	INCOMING_RSDVR_SCHEDULE.THEME_IDS AS THEME_IDS_INCOMING,
	INCOMING_RSDVR_SCHEDULE.SHORT_DESC  AS SHORT_DESC_INCOMING,
	INCOMING_RSDVR_SCHEDULE.LONG_DESC AS LONG_DESC_INCOMING,
	INCOMING_RSDVR_SCHEDULE.MPAA_RATING AS MPAA_RATING_INCOMING,
	INCOMING_RSDVR_SCHEDULE.TV_RATING AS TV_RATING_INCOMING,
	INCOMING_RSDVR_SCHEDULE.STEREO AS STEREO_INCOMING,
	INCOMING_RSDVR_SCHEDULE.SURROUND AS SURROUND_INCOMING,
	INCOMING_RSDVR_SCHEDULE.SAP AS SAP_INCOMING,
	INCOMING_RSDVR_SCHEDULE.CLOSEDCAPTION AS CLOSEDCAPTION_INCOMING,
	INCOMING_RSDVR_SCHEDULE.ANIMATED AS ANIMATED_INCOMING,
	INCOMING_RSDVR_SCHEDULE.BLACKWHITE AS BLACKWHITE_INCOMING,
	INCOMING_RSDVR_SCHEDULE.RERUN AS RERUN_INCOMING,
	INCOMING_RSDVR_SCHEDULE.LIVE AS LIVE_INCOMING,
	INCOMING_RSDVR_SCHEDULE.ISMOVIE AS ISMOVIE_INCOMING,
	INCOMING_RSDVR_SCHEDULE.NUDITY AS NUDITY_INCOMING,
	INCOMING_RSDVR_SCHEDULE.ADULTLANG AS ADULTLANG_INCOMING,
	INCOMING_RSDVR_SCHEDULE.VIOLENCE AS VIOLENCE_INCOMING,
	INCOMING_RSDVR_SCHEDULE.ADULTTHEME  AS ADULTTHEME_INCOMING,
	INCOMING_RSDVR_SCHEDULE.HALFSTARS AS HALFSTARS_INCOMING,
	INCOMING_RSDVR_SCHEDULE.HDTV AS HDTV_INCOMING,
	INCOMING_RSDVR_SCHEDULE.CVC_CALLSIGN  AS CVC_CALLSIGN_INCOMING,
	INCOMING_RSDVR_SCHEDULE.LOADTIME AS LOADTIME,
	INCOMING_RSDVR_SCHEDULE.STARTDATE_STARTTIME AS STARTDATE_STARTTIME_INCOMING,
	INCOMING_RSDVR_SCHEDULE.DS_STARTTIME AS DS_STARTTIME_INCOMING,
	INCOMING_RSDVR_SCHEDULE.LAST_UPDATED AS LAST_UPDATED_INCOMING,
	GOLD_RSDVR_SCHEDULE_LAST_REC.CALLSIGN     AS CALLSIGN_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.STARTDATE    AS STARTDATE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.STARTTIME    AS STARTTIME_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.DURATION     AS DURATION_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.SHORTTITLE   AS SHORTTITLE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.LONGTITLE    AS LONGTITLE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.THEMEIDS     AS THEMEIDS_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.SHORTDESC    AS SHORTDESC_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.LONGDESC     AS LONGDESC_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.MPAARATING   AS MPAARATING_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.TVRATING     AS TVRATING_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.STEREO       AS STEREO_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.SURROUND     AS SURROUND_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.SAP          AS SAP_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.CLOSEDCAPTION AS CLOSEDCAPTION_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.ANIMATED     AS ANIMATED_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.BLACKWHITE   AS BLACKWHITE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.RERUN        AS RERUN_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.LIVE         AS LIVE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.ISMOVIE      AS ISMOVIE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.NUDITY       AS NUDITY_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.ADULTLANG    AS ADULTLANG_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.VIOLENCE     AS VIOLENCE_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.ADULTTHEME   AS ADULTTHEME_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.HALFSTARS    AS HALFSTARS_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.HDTV         AS HDTV_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.CVCCALLSIGN  AS CVCCALLSIGN_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.STARTDATE_STARTTIME AS STARTDATE_STARTTIME_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.DS_STARTTIME AS DS_STARTTIME_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.LAST_UPDATED AS LAST_UPDATED_GOLD,
	GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE      AS OP_TYPE,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SHORT_TITLE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SHORTTITLE,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS SHORTTITLE_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.LONG_TITLE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.LONGTITLE,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS LONGTITLE_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.THEME_IDS,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.THEMEIDS,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS THEMEIDS_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SHORT_DESC,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SHORTDESC,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS SHORTDESC_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.LONG_DESC,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.LONGDESC,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS LONGDESC_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.MPAA_RATING,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.MPAARATING,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS MPAARATING_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.TV_RATING,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.TVRATING,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS TVRATING_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.STEREO,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.STEREO,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS STEREO_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SURROUND,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SURROUND,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS SURROUND_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SAP,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SAP,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS SAP_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.CLOSEDCAPTION,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.CLOSEDCAPTION,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS CLOSEDCAPTION_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ANIMATED,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ANIMATED,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS ANIMATED_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.BLACKWHITE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.BLACKWHITE,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS BLACKWHITE_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.RERUN,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.RERUN,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS RERUN_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.LIVE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.LIVE,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS LIVE_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ISMOVIE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ISMOVIE,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS ISMOVIE_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.NUDITY,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.NUDITY,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS NUDITY_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ADULTLANG,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ADULTLANG,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS ADULTLANG_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.VIOLENCE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.VIOLENCE,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS VIOLENCE_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ADULTTHEME,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ADULTTHEME,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS ADULTTHEME_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.HALFSTARS,-1) = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.HALFSTARS,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS HALFSTARS_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.HDTV,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.HDTV,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS HDTV_IND,
	IF(IF(COALESCE(INCOMING_RSDVR_SCHEDULE.CVC_CALLSIGN,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.CVCCALLSIGN,'*'),1,0) = 0 OR (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE ='D'),'Y','N' ) AS CVCCALLSIGN_IND,
	IF(GOLD_RSDVR_SCHEDULE_LAST_REC.CALLSIGN IS NOT NULL AND  ( IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ADULTLANG,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ADULTLANG,'*'),1,0) = 0  OR IF (COALESCE(INCOMING_RSDVR_SCHEDULE.ADULTTHEME,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ADULTTHEME,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ANIMATED,'*') =  COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ANIMATED,'*'),1,0) = 0  OR IF (COALESCE(INCOMING_RSDVR_SCHEDULE.BLACKWHITE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.BLACKWHITE,'*'),1,0) = 0  OR IF (COALESCE(INCOMING_RSDVR_SCHEDULE.CLOSEDCAPTION,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.CLOSEDCAPTION,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.HALFSTARS,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.HALFSTARS,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.HDTV,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.HDTV,'*'),1,0) = 0 OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.ISMOVIE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.ISMOVIE,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.LIVE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.LIVE,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.LONG_DESC,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.LONGDESC,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.LONG_TITLE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.LONGTITLE,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.MPAA_RATING,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.MPAARATING,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.NUDITY,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.NUDITY,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.RERUN,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.RERUN,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SAP,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SAP,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SHORT_DESC,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SHORTDESC,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SHORT_TITLE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SHORTTITLE,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.STEREO,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.STEREO,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.SURROUND,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.SURROUND,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.THEME_IDS,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.THEMEIDS,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.TV_RATING,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.TVRATING,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.VIOLENCE,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.VIOLENCE,'*'),1,0) = 0  OR IF(COALESCE(INCOMING_RSDVR_SCHEDULE.CVC_CALLSIGN,'*') = COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.CVCCALLSIGN,'*'),1,0) = 0  OR (COALESCE(GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE,'*') = 'D' AND TO_DATE(LOADTIME) = TO_DATE('${hivevar:dtm_end}')) ),TRUE,FALSE ) AS CHANGEDFLAG,
	IF(GOLD_RSDVR_SCHEDULE_LAST_REC.CALLSIGN IS NULL AND GOLD_RSDVR_SCHEDULE_LAST_REC.DURATION IS NULL AND GOLD_RSDVR_SCHEDULE_LAST_REC.STARTDATE IS NULL AND GOLD_RSDVR_SCHEDULE_LAST_REC.STARTTIME IS NULL, 'TRUE','FALSE') AS NEWFLAG,
	cast('${hivevar:dtm_start}' as date) as LOAD_DATE,
	CURRENT_TIMESTAMP AS SYSDATE,
	'Y' AS Y_IND,
	'I' AS OP_TYPE_I,
	IF (GOLD_RSDVR_SCHEDULE_LAST_REC.OP_TYPE = 'D','I','U') AS OP_TYPE_U	
FROM
	${hivevar:hive_database_name_incoming}.${hivevar:incoming_rsdvr_schedule_tbl} INCOMING_RSDVR_SCHEDULE LEFT OUTER JOIN ${hivevar:hive_database_name_gold}.${hivevar:gold_rsdvr_schedule_last_rec} GOLD_RSDVR_SCHEDULE_LAST_REC
ON  
	(INCOMING_RSDVR_SCHEDULE.CALLSIGN = GOLD_RSDVR_SCHEDULE_LAST_REC.CALLSIGN AND
	INCOMING_RSDVR_SCHEDULE.STARTDATE = GOLD_RSDVR_SCHEDULE_LAST_REC.STARTDATE AND
	(case when (length(INCOMING_RSDVR_SCHEDULE.starttime)=3) then concat(substr(concat('0',INCOMING_RSDVR_SCHEDULE.starttime),0,2),':',substr(concat('0',INCOMING_RSDVR_SCHEDULE.starttime),3,2),':00') when (length(INCOMING_RSDVR_SCHEDULE.starttime)=2) then concat(substr(concat('00',INCOMING_RSDVR_SCHEDULE.starttime),0,2),':',substr(concat('00',INCOMING_RSDVR_SCHEDULE.starttime),3,2),':00') when (length(INCOMING_RSDVR_SCHEDULE.starttime)=1) then concat(substr(concat('000',INCOMING_RSDVR_SCHEDULE.starttime),0,2),':',substr(concat('000',INCOMING_RSDVR_SCHEDULE.starttime),3,2),':00') else concat(substr(INCOMING_RSDVR_SCHEDULE.starttime,0,2),':',substr(INCOMING_RSDVR_SCHEDULE.starttime,3,2),':00') end )  = GOLD_RSDVR_SCHEDULE_LAST_REC.STARTTIME AND
	INCOMING_RSDVR_SCHEDULE.DURATION = GOLD_RSDVR_SCHEDULE_LAST_REC.DURATION)	

WHERE 
	INCOMING_RSDVR_SCHEDULE.load_date='${hivevar:source_date}'
;	

--##############################################################################
--#                                    END                                     #
--##############################################################################